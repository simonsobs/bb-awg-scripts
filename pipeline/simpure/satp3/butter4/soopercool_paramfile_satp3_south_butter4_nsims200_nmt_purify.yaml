output_directory: &out_dir /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/transfer_function/butter4_cutoff_1e-2/soopercool_outputs_nsims_200_nmt_purify

map_sets:
  SATp3_f090_south_science:
    map_dir: /scratch/gpfs/SIMONSOBS/sat-iso/mapmaking/satp3_20250108/bundles/south
    beam_dir: /scratch/gpfs/SIMONSOBS/sat-iso/transfer_function/soopercool_inputs
    map_template: "satp3_f090_full_bundle{id_bundle}_{map|hits}.fits"
    beam_file: "beam_unity.dat"
    n_bundles: 1          # Number of bundles
    freq_tag: 90         # Freq. tag (e.g. useful to coadd freqs)
    exp_tag: "SATp3"      # Experiment tag (useful to get noise-bias free cross-split spectra)
    filtering_tag: "SATp3_f090_south_science"

####################
# Masking metadata #
####################
masks:
  analysis_mask: /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/soopercool_inputs/masks/analysis_mask_apo10_C1.fits
  # When specifying this file, the mapset/bundle-specific hits files will
  # be ignored and instead a global hits file will be used (testing puroposes)
  global_hits:

  # Path to products (binary)
  galactic_mask: /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/soopercool_inputs/planck_gal_mask_proj/planck_galmask_070_CAR_20arcmin.fits
  point_source_catalog: null
  point_source_mask: null  # "/path/to/point_source_mask.fits"

  external_mask: null

  apod_radius: 10.0
  apod_radius_point_source: 1.0
  apod_type: "C1"

####################################
# Metadata related to the analysis #
####################################
## General parameters
general_pars:
  pix_type: car
  car_template: /home/kw6905/bbdev/bb-awg-scripts/pipeline/simpure/band_car_fejer1_20arcmin.fits
  nside: 512
  lmin: 5
  lmax: 495
  binning_file: /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/soopercool_inputs/binning/binning_car_lmax540_deltal10_large_first_bin.npz
  pure_B: True
  # Where the beam window is lower than beam_floor, set it to beam_floor
  beam_floor: 1.e-2

transfer_settings:
  transfer_directory: !path [*out_dir, transfer_functions]

  # For estimation
  ## Number of sims for tf estimation and validation
  tf_est_num_sims: 200
  tf_val_num_sims: 10
  sim_id_start: 0

  ## Parameters of the PL sims used for TF estimation
  power_law_pars_tf_est:
    amp: 1.0
    delta_ell: 10
    power_law_index: 2.

  ## Optional beams applied on PL sims
  # If true, beams will be applied only on the validation simulations. By default (false)
  # beam are applied to both the estimation and validation sims,
  # to account for potential effect of the beam on the TF (e.g. commutativity)
  do_not_beam_est_sims: True
  beams_list: []

  ## Path to the sims for TF estimation
  unfiltered_map_dir:
    estimation:
      SATp3_f090_south_science: /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/input_sims
    validation:
      SATp3_f090_south_science: /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/cmb_sims
  unfiltered_map_template:
    estimation:
      SATp3_f090_south_science: "{pure_type}_20.0arcmin_fwhm30.0_sim{id_sim:04d}_CAR.fits"
    validation:
      SATp3_f090_south_science: "cmbEB_20arcmin_fwhm30.0_sim{id_sim:04d}_CAR.fits"
  filtered_map_dir:
    estimation:
      SATp3_f090_south_science: /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/satp3/south/f090/transfer_function/butter4_cutoff_1e-2/coadded_sims
    validation:
      SATp3_f090_south_science: /scratch/gpfs/SIMONSOBS/users/kw6905/simpure/satp3/south/f090/cmb_sims/butter4_cutoff_1e-2/coadded_sims
  filtered_map_template:
    estimation:
      SATp3_f090_south_science: "{pure_type}_20.0arcmin_fwhm30.0_sim{id_sim:04d}_CAR_f090_science_filtered.fits"
    validation:
      SATp3_f090_south_science: "cmbEB_20arcmin_fwhm30.0_sim{id_sim:04d}_CAR_f090_science_filtered.fits"

# Covariance-related parameters
covariance:
  ## Number of sims for covariance estimation
  cov_num_sims: 50  # todo

  ## Directories and file names of simulated noise maps
  noise_map_sims_dir:
    SATp3_f090_south_science: ../signflip_maps  # todo
    SATp3_f150_south_science: ../signflip_maps  # todo

  # The file name templates for noise sims. The parameters id_sim, map_set, and
  # id_bundle will be recognized when written inside braces, and interpreted
  # during python string formatting.
  noise_map_sims_template:
    SATp3_f090_south_science: "{map_set}_bundle{id_bundle}_sim{id_sim:04d}_noise.fits"  # todo
    SATp3_f150_south_science: "{map_set}_bundle{id_bundle}_sim{id_sim:04d}_noise.fits"  # todo

  # FIXME: We need the products below
  ## Directories and file names of simulated signal alms
  signal_alm_sims_dir:
    SATp3_f090_south_science: ../cmb_sims/filtered_science  # todo
    SATp3_f150_south_science: ../cmb_sims/filtered_science  # todo
  # The parameters id_sim, freq_tag, and id_sim will be recognized during 
  # python string formatting if written inside braces.
  signal_alm_sims_template:
    SATp3_f090_south_science: "alm_cmb_lmax..._fwhm30.0_{id_sim:04}_bundle0_filtered.fits"  # todo
    SATp3_f150_south_science: "alm_cmb_lmax..._fwhm30.0_{id_sim:04}_bundle0_filtered.fits"  # todo
