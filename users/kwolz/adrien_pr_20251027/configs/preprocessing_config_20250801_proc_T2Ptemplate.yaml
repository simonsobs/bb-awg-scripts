context_file: 'contexts/satp1/use_this_local_250801.yaml'
#plot_dir: '/global/cfs/cdirs/sobs/sat-iso/v3/preprocessing/satp1_20250801_proc/preprocess_plots'
plot_dir: '/scratch/gpfs/SIMONSOBS/sat-iso/v3/preprocessing/satp1_20250801_proc/preprocess_plots'

subobs:
  use: ['wafer_slot', 'wafer.bandpass']
  label: wafer_slot
  
archive:
  #index: '/global/cfs/cdirs/sobs/sat-iso/v3/preprocessing/satp1_20250801_proc/process_archive.sqlite'
  index: '/scratch/gpfs/SIMONSOBS/sat-iso/v3/preprocessing/satp1_20250801_proc/process_archive.sqlite'
  policy:
    type: 'simple'
    #filename: '/global/cfs/cdirs/sobs/sat-iso/v3/preprocessing/satp1_20250801_proc/preprocess_archive.h5'
    filename: '/scratch/gpfs/SIMONSOBS/sat-iso/v3/preprocessing/satp1_20250801_proc/preprocess_archive.h5'

process_pipe:
    - name: "azss"
      skip_on_sim: True  # No estimation on sims
      calc:
        signal: 'dsT'
        azss_stats_name: 'azss_statsT_left'
        azrange: [-1.57079, 7.85398]
        bins: 1351 # This is 0.4 deg bins.
        flags: 'glitch_flags_left'
        merge_stats: True
        merge_model: False
      save: True
      process:
        subtract: False

    - name: "subtract_azss_template"
      skip_on_sim: False
      process:
        signal: 'dsT'
        azss: 'azss_statsT_left'
        method: 'interpolate'
        scan_flags: 'left_scan'
        subtract: True

    - name: "azss"
      skip_on_sim: True  # No estimation on sims
      calc:
        signal: 'demodQ'
        azss_stats_name: 'azss_statsQ_left'
        azrange: [-1.57079, 7.85398]
        bins: 1351 # This is 0.4 deg bins.
        flags: 'glitch_flags_left'
        merge_stats: True
        merge_model: False
      save: True
      process:
        subtract: False
        
    - name: "subtract_azss_template"
      skip_on_sim: False
      process:
        signal: 'demodQ'
        azss: 'azss_statsQ_left'
        method: 'interpolate'
        scan_flags: 'left_scan'
        subtract: True

    - name: "azss"
      skip_on_sim: True  # No estimation on sims
      calc:
        signal: 'demodU'
        azss_stats_name: 'azss_statsU_left'
        azrange: [-1.57079, 7.85398]
        bins: 1351 # This is 0.4 deg bins.
        flags: 'glitch_flags_left'
        merge_stats: True
        merge_model: False
      save: True
      process:
        subtract: False

    - name: "subtract_azss_template"
      skip_on_sim: False
      process:
        signal: 'demodU'
        azss: 'azss_statsU_left'
        method: 'interpolate'
        scan_flags: 'left_scan'
        subtract: True

    - name: "azss"
      skip_on_sim: True  # No estimation on sims
      calc:
        signal: 'dsT'
        azss_stats_name: 'azss_statsT_right'
        azrange: [-1.57079, 7.85398]
        bins: 1351 # This is 0.4 deg bins.
        flags: 'glitch_flags_right'
        merge_stats: True
        merge_model: False
      save: True
      process:
        subtract: False

    - name: "subtract_azss_template"
      skip_on_sim: False
      process:
        signal: 'dsT'
        azss: 'azss_statsT_right'
        method: 'interpolate'
        scan_flags: 'right_scan'
        subtract: True

    - name: "azss"
      skip_on_sim: True  # No estimation on sims
      calc:
        signal: 'demodQ'
        azss_stats_name: 'azss_statsQ_right'
        azrange: [-1.57079, 7.85398]
        bins: 1351 # This is 0.4 deg bins.
        flags: 'glitch_flags_right'
        merge_stats: True
        merge_model: False
      save: True
      process:
        subtract: False

    - name: "subtract_azss_template"
      skip_on_sim: False
      process:
        signal: 'demodQ'
        azss: 'azss_statsQ_right'
        method: 'interpolate'
        scan_flags: 'right_scan'
        subtract: True

    - name: "azss"
      skip_on_sim: True  # No estimation on sims
      calc:
        signal: 'demodU'
        azss_stats_name: 'azss_statsU_right'
        azrange: [-1.57079, 7.85398]
        bins: 1351 # This is 0.4 deg bins.
        flags: 'glitch_flags_right'
        merge_stats: True
        merge_model: False
      save: True
      process:
        subtract: False

    - name: "subtract_azss_template"
      skip_on_sim: False
      process:
        signal: 'demodU'
        azss: 'azss_statsU_right'
        method: 'interpolate'
        scan_flags: 'right_scan'
        subtract: True
        
    - name: "estimate_t2p"
      skip_on_sim: True  # No estimation on sims
      calc:
        flag_name: "glitch_flags"
        f_lpf_cutoff: 4
      save: True