ext_data_directory: &ext_data_dir /scratch/gpfs/SIMONSOBS/external_data_e2e/
iso_directory: &iso_dir /scratch/gpfs/SIMONSOBS/sat-iso/v4
output_directory: &out_dir !path [*ext_data_dir, /v4/spectra/filtered_satp3_f090/south/full-dataset/science]
transfer_dir: &transfer_dir !path [*iso_dir, spectra/satp3/south/full-dataset/science]
inputs_dir: &inputs_dir !path [*iso_dir, soopercool_inputs]
signflip_dir: &sf_dir !path [*iso_dir, noise/satp3_20251216/signflip/south/]

map_sets:
  satp3_f090_south_science:
    map_dir: !path [*iso_dir, bundling/satp3_20251216/south]
    beam_dir: !path [*inputs_dir, beams]
    map_template: "satp3_f090_science_bundle{id_bundle}_{map|hits}.fits"
    beam_file: "beam_unity.dat"
    n_bundles: 4          # Number of bundles
    freq_tag: 090         # Freq. tag (e.g. useful to coadd freqs)
    exp_tag: "satp3"      # Experiment tag (useful to get noise-bias free cross-split spectra)
    filtering_tag: "satp3_f090_south_science"
  satp3_f150_south_science:
    map_dir: !path [*iso_dir, bundling/satp3_20251216/south]
    beam_dir: !path [*inputs_dir, beams]
    map_template: "satp3_f150_science_bundle{id_bundle}_{map|hits}.fits"
    beam_file: "beam_unity.dat"
    n_bundles: 4
    freq_tag: 150
    exp_tag: "satp3"
    filtering_tag: "satp3_f150_south_science"
  wmap_f023_filtered_satp3_f090_south_science:
    map_dir: !path [*ext_data_dir, /v4/filtered_ext_data/wmap/fK/satp3/south/f090/coadded_maps]
    beam_dir: !path [*ext_data_dir, unfiltered_data/wmap/beams/]
    map_template: "wmap_car_K_bundle{id_bundle}_res1.0amin_coords_c_bundle{id_bundle}_f090_science_{filtered|filtered_weights}.fits"
    beam_file: "wmap_ampl_bl_K1_9yr_v5p1_long.txt"
    n_bundles: 2
    freq_tag: 23         # Freq. tag (e.g. useful to coadd freqs) Used the ext data one
    exp_tag: "wmap"      # Experiment tag (useful to get noise-bias free cross-split spectra)
    filtering_tag: "satp3_f090_south_science"  # tag only used for couplings and transfer function
  wmap_f033_filtered_satp3_f090_south_science:
    map_dir: !path [*ext_data_dir, /v4/filtered_ext_data/wmap/fKa/satp3/south/f090/coadded_maps]
    beam_dir: !path [*ext_data_dir, unfiltered_data/wmap/beams/]
    map_template: "wmap_car_Ka_bundle{id_bundle}_res1.0amin_coords_c_bundle{id_bundle}_f090_science_{filtered|filtered_weights}.fits"
    beam_file: "wmap_ampl_bl_Ka1_9yr_v5p1_long.txt"
    n_bundles: 2
    freq_tag: 33
    exp_tag: "wmap"
    filtering_tag: "satp3_f090_south_science"  # tag only used for couplings and transfer function
  planck_f030_filtered_satp3_f090_south_science:
    map_dir: !path [*ext_data_dir, /v4/filtered_ext_data/planck/f030/satp3/south/f090/coadded_maps]
    beam_dir: !path [*ext_data_dir, unfiltered_data/planck/beam_window_functions/]
    map_template: "planck_car_030_bundle{id_bundle}_res1.0amin_coords_c_bundle{id_bundle}_f090_science_{filtered|filtered_weights}.fits"
    beam_file: "beam_pol_030_long.txt"
    n_bundles: 2
    freq_tag: 030
    exp_tag: "planck"
    filtering_tag: "satp3_f090_south_science"  # tag only used for couplings and transfer function
  planck_f100_filtered_satp3_f090_south_science:
    map_dir: !path [*ext_data_dir, /v4/filtered_ext_data/planck/f100/satp3/south/f090/coadded_maps]
    beam_dir: !path [*ext_data_dir, unfiltered_data/planck/beam_window_functions/]
    map_template: "planck_car_100_bundle{id_bundle}_res1.0amin_coords_c_bundle{id_bundle}_f090_science_{filtered|filtered_weights}.fits"
    beam_file: "beam_pol_100_long.txt"
    n_bundles: 2
    freq_tag: 100
    exp_tag: "planck"
    filtering_tag: "satp3_f090_south_science"  # tag only used for couplings and transfer function
  planck_f143_filtered_satp3_f090_south_science:
    map_dir: !path [*ext_data_dir, /v4/filtered_ext_data/planck/f143/satp3/south/f090/coadded_maps]
    beam_dir: !path [*ext_data_dir, unfiltered_data/planck/beam_window_functions/]
    map_template: "planck_car_143_bundle{id_bundle}_res1.0amin_coords_c_bundle{id_bundle}_f090_science_{filtered|filtered_weights}.fits"
    beam_file: "beam_pol_143_long.txt"
    n_bundles: 2
    freq_tag: 143
    exp_tag: "planck"
    filtering_tag: "satp3_f090_south_science"  # tag only used for couplings and transfer function
  planck_f217_filtered_satp3_f090_south_science:
    map_dir: !path [*ext_data_dir, /v4/filtered_ext_data/planck/f217/satp3/south/f090/coadded_maps]
    beam_dir: !path [*ext_data_dir, unfiltered_data/planck/beam_window_functions/]
    map_template: "planck_car_217_bundle{id_bundle}_res1.0amin_coords_c_bundle{id_bundle}_f090_science_{filtered|filtered_weights}.fits"
    beam_file: "beam_pol_217_long.txt"
    n_bundles: 2
    freq_tag: 217
    exp_tag: "planck"
    filtering_tag: "satp3_f090_south_science"  # tag only used for couplings and transfer function
  planck_f353_filtered_satp3_f090_south_science:
    map_dir: !path [*ext_data_dir, /v4/filtered_ext_data/planck/f353/satp3/south/f090/coadded_maps]
    beam_dir: !path [*ext_data_dir, unfiltered_data/planck/beam_window_functions/]
    map_template: "planck_car_353_bundle{id_bundle}_res1.0amin_coords_c_bundle{id_bundle}_f090_science_{filtered|filtered_weights}.fits"
    beam_file: "beam_pol_353_long.txt"
    n_bundles: 2
    freq_tag: 353
    exp_tag: "planck"
    filtering_tag: "satp3_f090_south_science"  # tag only used for couplings and transfer function
  

####################
# Masking metadata #
####################
masks:
  # Specify coordinates if using a rectangular mask
  box_mask: null
  # Set to True if mask is calculated from the weights,
  # otherwise set to False to use the hits
  use_weights: False
  analysis_mask: !path [*out_dir, masks/analysis_mask.fits]
  # When specifying this file, the mapset/bundle-specific hits files will
  # be ignored and instead a global hits file will be used (testing puroposes)
  global_hits: !path [*iso_dir, spectra/satp3/south/full-dataset/science/masks/normalized_hits.fits]
  # Path to products (binary)
  galactic_mask: !path [*inputs_dir, masks/mask_GAL070_coords_c_sat_f090_geometry.fits]
  point_source_catalog: null
  point_source_mask: null
  external_mask: null
  # Apodization details
  apod_radius: 10.0
  smoothing_radius: 10.0
  apod_radius_point_source: 1.0
  apod_type: "C1"

####################################
# Metadata related to the analysis #
####################################
## General parameters
general_pars:
  pix_type: car
  car_template: /scratch/gpfs/SIMONSOBS/so/science-readiness/geometry/sat_f090.fits
  nside: 512
  lmin: 2
  lmax: 803
  binning_file: /scratch/gpfs/SIMONSOBS/sat-iso/v4/spectra/satp3/south/full-dataset/science/binning/binning_car_lmax2700_deltal15.npz
  pure_B: False
  # Where the beam window is lower than beam_floor, set it to beam_floor
  beam_floor: 1.e-2
  compute_Dl: True

covariance:
  cov_num_sims: 200
  fiducial_cmb: null
  fiducial_dust: null
  fiducial_synch: null

transfer_settings:
  transfer_directory: !path [*transfer_dir, transfer_functions]

  external_couplings_dir: !path [*out_dir, couplings]
  